name: Deploy EnlaceCRM backend autom√°tico

on:
  push:
    branches: [main, develop]

jobs:

  deploy-main:
    if: github.ref == 'refs/heads/main'
    runs-on: self-hosted
    steps:
      - name: Actualizar repositorio main
        run: |
          cd /home/s-appadm/EnlaceCRM_Backend
          git reset --hard
          git pull origin main

      - name: Docker deploy main
        run: |
          cd /home/s-appadm/EnlaceCRM_Backend
          docker compose down
          docker compose up -d --build


  deploy-develop:
    if: github.ref == 'refs/heads/develop'
    runs-on: self-hosted
    steps:
      - name: Actualizar repositorio develop
        run: |
          cd /home/s-appadm/EnlaceCRM_Backend_Dev
          git reset --hard
          git pull origin develop

      - name: PM2 deploy develop
        run: |
          cd /home/s-appadm/EnlaceCRM_Backend_Dev
          pm2 restart develop --update-env
